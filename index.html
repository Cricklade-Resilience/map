<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaflet Layer Control with Async GeoJSON</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([51.6409, -1.8577], 14);

  // Add base layer
  const baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  const layersToLoad = [
    { name: "Flood Zone 2", file: "points.geojson" },
    { name: "Flood Zone 3", file: "points.geojson" },
    { name: "SUDS Areas", file: "polygons.geojson" }
  ];

  const overlays = {};
  const loadPromises = [];

  layersToLoad.forEach(({name, file}, index) => {
    const layer = L.geoJSON(null, {
      onEachFeature: function (feature, layer) {
        const label = feature.properties?.id || "No ID";
        layer.bindTooltip(label, {
          permanent: true,
          direction: "center",
          className: "polygon-label"
    });
  }


    const p = fetch(`Data/${file}`)
      .then(res => res.json())
      .then(data => {
        layer.addData(data);

        // Add first layer to the map by default
        if (index === 0) {
          layer.addTo(map);
        }

        overlays[name] = layer;
      });

    loadPromises.push(p);
  });

  Promise.all(loadPromises).then(() => {
    // Add layer control after all layers are loaded
    L.control.layers({ "OpenStreetMap": baseLayer }, overlays, { collapsed: false }).addTo(map);
  });

</script>

</body>
</html>
